# AOP μ”μ•½

μ΄μ „ gitbook legacy AOP μ‘μ„± λ¶€λ¶„μ—μ„ μ§μ§‘κΈ°ν•μ—¬ μ‘μ„±ν•λ‹¤.

## ν•„μ”μ„±

κ°μ²΄ μ§€ν–¥ ν”„λ΅κ·Έλλ°(OOP)κ°€ κ³µν†µλ κΈ°λ¥μ„ μ¬μ‚¬μ©ν•λ” κ²ƒμ— λ€ν• λ°©λ²•μ€ μ΄λ―Έ μ΅΄μ¬ν•λ‹¤. (μƒμ†κ³Ό μ„μ„) κ·Έλ¬λ‚ μ „μ²΄ μ• ν”λ¦¬μΌ€μ΄μ…μ— μ—¬κΈ°μ €κΈ°μ— μ‚¬μ©λλ” λ¶€κ°€κΈ°λ¥μ„ μƒμ†μ΄λ‚ μ„μ„μΌλ΅ μ²λ¦¬ν•κΈ°μ—λ” λ¨λ“μ λ¶„λ¦¬κ°€ μ–΄λ µλ‹¤.

μ΄μ— μ”κµ¬μ— λ”°λΌ κ΄€μ  μ§€ν–¥ ν”„λ΅κ·Έλλ°(AOP)μ€ λ¶€κ°€κΈ°λ¥ μμ²΄λ¥Ό λ¨λ“ν™”ν•μ—¬ κ΄€λ¦¬ν•κ³ , μ„λΉ„μ¤λ” λ¶€κ°€κΈ°λ¥μ„ μµλ€ν• μ‹ κ²½μ“°μ§€ μ•μ•„λ„ λλ‹¤. μ΄λ¬ν• λ¶€κ°€κΈ°λ¥μ€ μ• ν”λ¦¬μΌ€μ΄μ… μ „μ²΄μ— μ μ©λ  μλ„ μλ”λ°, μ΄λ¥Ό μΈν”„λΌ λ΅μ§μ΄λΌκ³  λ§ν•  μ μλ‹¤.

- OOP μ λ¨λ“ λ‹¨μ„λ” μ„λΉ„μ¤λ¥Ό μν–‰ν•λ” λΉ„μ§€λ‹μ¤ λ΅μ§, μΆ…λ‹¨μ— λ€ν• κΈ°λ¥
- AOP μ λ¨λ“ λ‹¨μ„λ” μ„λΉ„μ¤μ— λ€ν• λ¶€κ°€κΈ°λ¥, ν΅λ‹¨μ— λ€ν• κΈ°λ¥

*****

## μ©μ–΄

### `Aspect`

ν•µμ‹¬ κΈ°λ¥μ— λ€ν• λ¶€κ°€κΈ°λ¥μ„ κ°€μ§„ λ¨λ“ (μ‘μ„±ν• λ¨λ“ κ·Έ μμ²΄)

### `Target`

λ¶€κ°€ κΈ°λ¥μ„ μ‚¬μ©ν•  λ€μƒμ„ λ§ν•λ‹¤.

### `Advice`

> "λ¬΄μ—‡", "μ–Έμ "

μ‹¤μ  λ™μ‘μ„ κ°€μ§€λ” λ¶€κ°€κΈ°λ¥ μ½”λ“λ¥Ό λ§ν•λ‹¤. λ”ν•μ—¬ μ–΄λ“λ°”μ΄μ¤λ” λ€μƒμ΄ λλ” μ½”λ“μ μ‹¤ν–‰ μ‹μ μ„ κ°€μ§„λ‹¤.

### `PointCut`

> "λ„κ°€"

μ–΄λ“λ°”μ΄μ¤μ— λ€μƒμ΄ λλ” μ μ© λ€μƒμ„ κ²°μ •ν•λ” ν‘ν„μ‹μ΄λ‹¤.

### `JoinPoint`

> "μ–΄λ””μ—μ„"

μ‹¤ν–‰ κ°€λ¥ν• νΉμ • μ§€μ μ„ μ •ν•λ‹¤. λ‹¨ μ¤ν”„λ§μ€ **λ©”μ†λ“** μ΅°μΈν¬μΈνΈλ§ μ κ³µν•λ‹¤.

### `Proxy`

> ν”„λ΅μ‹("λ„κ°€")

λ€μƒμ΄ λλ” νƒ€κ²μ„ κ°μ‹Έ μ”μ²­μ„ λ€μ‹  λ°›λ” λν•‘ κ°μ²΄μ΄λ‹¤.

### `Introduction`

λ€μƒμ΄ λλ” νƒ€κ² κ°μ²΄μ μ½”λ“ λ³€κ²½ μ—†μ΄ λ©”μ†λ“, λ³€μ λ“±μ„ μ¶”κ°€ν•λ” κΈ°λ¥μ΄λ‹¤.

### `Weaving`

λ€μƒμ΄ λλ” νƒ€κ² κ°μ²΄λ¥Ό ν”„λ΅μ‹ κ°μ²΄λ΅ μƒμ„±ν•λ” κ³Όμ •μ΄λ‹¤.

*****

## κµ¬λ¶„

| | Spring AOP | AspectJ |
| --- | --- | --- |
| μ κ³µ λ²”μ„ | κ°„λ‹¨ν• AOP | λ¨λ“  AOP |
| `JoinPoint` | λ©”μ†λ“ λ λ²¨ | μƒμ„±μ, ν•„λ“, λ©”μ†λ“ λ“±μ λ‹¤μ–‘ν• λ λ²¨ |
| `Weaving` | λ°νƒ€μ„ | λ°νƒ€μ„μ„ μ μ™Έν• μ»΄νμΌ μ‹μ , μ»΄νμΌ μ΄μ „ μ‹μ , λ΅λ“ νƒ€μ„ μ‹μ  |
| μ μ© κ°€λ¥ λ€μƒ | IoC μ»¨ν…μ΄λ„κ°€ κ΄€λ¦¬ν•λ” λΉ | λ¨λ“  μλ°” κ°μ²΄ |

### μ»΄νμΌ κΈ°λ° (Aspect J)

> A.java β†’ (AOP) β†’ A.class

`A.java` νμΌμ΄ μ»΄νμΌ λλ” μ‹μ μ— AOP μ½”λ“λ¥Ό λΌμ› λ„£μ–΄ `A.class` κ°€ λλ‹¤.

### λ°”μ΄νΈμ½”λ“ μ΅°μ‘ (Aspect J)

> A.java β†’ A.class β†’ in memory (AOP) A.class (λ°νƒ€μ„μ—μ„ ν΄λμ¤ λ΅λ”)

`A.java` νμΌμ„ `A.class` νμΌλ΅ μ»΄νμΌν•κ³  λ‚ν›„ λ°νƒ€μ„μ—μ„ ν΄λμ¤ λ΅λ”κ°€ λ©”λ¨λ¦¬λ΅ μ¬λ¦¬λ” μ‹μ μ— λ°”μ΄νΈ μ½”λ“λ¥Ό μ΅°μ‘ν•μ—¬ `A.class` μ— AOP μ½”λ“λ¥Ό λΌμ› λ„£λ”λ‹¤.

### ν”„λ΅μ‹ ν¨ν„΄ κΈ°λ° (Spring AOP)

> λ””μμΈ ν¨ν„΄ κΈ°λ°μ AOP

AOP λ¥Ό μ μ©ν•μ§€ μ•μ€ AService μ `.getClass().getName()` μ‹¤ν–‰μ‹ `ν¨ν‚¤μ§€.AService` λ΅ μ°ν κ²ƒμ΄λ‹¤.

κ·Έλ¬λ‚ AOP λ¥Ό μ μ©ν• AService μ `.getClass().getName()` μ‹¤ν–‰μ‹ `ν¨ν‚¤μ§€.AService$$~~~` λ΅ μ°νλ‹¤. μ΄λ¥Ό μ—΄μ–΄λ³΄κ² λλ©΄ ν”„λ΅μ‹ κ°μ²΄κ°€ AService λ¥Ό κ°μ‹Έμ„ λ‹΄κ³  μλ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

*****

## μ–΄λ“λ°”μ΄μ¤

### `@Before`

```text
[request] β†’ [advice] β†’ [target]
```

### `@AfterReturning`

```text
[request] β†’ [target (μ •μƒ λ°ν™)] β†’ [advice]
```

### `@AfterThrowing`

```text
[request] β†’ [target (μμ™Έ λ°μƒ)] β†’ [advice]
```

### `@After`

```text
[request] β†’ [target] β†’ [advice]
```

### `@Around`

```text
[request] β†’ [advice] β†’ [target] β†’ [advice]
```

### μ–΄λ“λ°”μ΄μ¤μ μ‹¤ν–‰ μμ„

μ—¬λ¬ κ°μ μ–΄λ“λ°”μ΄μ¤κ°€ λ¨λ‘ κ°™μ€ μ΅°μΈν¬μΈνΈμ—μ„ μ‹¤ν–‰λ  λ• μ–΄λ–¤ μΌμ΄ λ°μƒν•λ”κ°€? μ¤ν”„λ§ AOP λ” AspectJ μ™€ λ™μΌν• μ„ ν–‰ κ·μΉ™μ„ λ”°λΌ μ–΄λ“λ°”μ΄μ¤ μ‹¤ν–‰ μμ„λ¥Ό κ²°μ •ν•λ‹¤.

- "μ•μΌλ΅ λ“¤μ–΄κ° λ•(`@Before`)" λ” μ°μ„  μμ„κ°€ κ°€μ¥ λ†’μ€ μ–΄λ“λ°”μ΄μ¤κ°€ λ¨Όμ € μ‹¤ν–‰λλ‹¤. μ΄μ— λ”°λΌ λΉ„ν¬κ°€ 2κ°κ°€ μ£Όμ–΄μ§„λ‹¤λ©΄ κ°€μ¥ μ°μ„  μμ„κ°€ λ†’μ€ λΉ„ν¬κ°€ λ¨Όμ € μ‹¤ν–‰λλ‹¤.
- "λ°–μΌλ΅ λ‚μ¬ λ•(`@After` ~~)" λ” κ°€μ¥ λ†’μ€ μ°μ„  μμ„ μ–΄λ“λ°”μ΄μ¤κ°€ λ§μ§€λ§‰μΌλ΅ μ‹¤ν–‰λλ‹¤. λ”°λΌμ„ 2κ°μ μ• ν”„ν„°κ°€ μ£Όμ–΄μ§€λ©΄ μ°μ„  μμ„κ°€ κ°€μ¥ λ†’μ€ μ• ν”„ν„°κ°€ 2λ²μ§Έ μ‹¤ν–‰λλ‹¤.

`Order` μ–΄λ…Έν…μ΄μ…μΌλ΅ μΌλ°μ μΈ μ¤ν”„λ§ λ°©μ‹μΌλ΅ μν–‰λλ‹¤. 2κ°€μ§€ μ• μ¤ν©νΈμ—μ„ λ³΄λ©΄ `Ordered.getValue()` (λλ” μ–΄λ…Έν…μ΄μ… κ°’) μ—μ„ λ‚®μ€ κ°’μ„ λ°ν™ν•λ” μ• μ¤ν™νΈκ°€ λ” λ†’μ€ μ°μ„  μμ„λ¥Ό κ°€μ§„λ‹¤.

> μ—¬λ¬ κ°μ μ–΄λ“λ°”μ΄μ¤μ— λ€μƒμ΄ λλ‹¤λ” κ²ƒμ€ λ¦¬ν©ν† λ§ ν•΄μ•Όν•λ” μƒν™©μΌ μ λ„ μλ‹¤λ” κ²ƒμ„ μΈμ§€ν•΄μ•Ό ν•λ‹¤.

*****

## ν¬μΈνΈ μ»·

ν¬μΈνΈ μ»·μ€ ν¬κ² μ§€μ •μμ™€ νƒ€κ² λ…μ„Έλ΅ λ‚λ„μ–΄μ§„λ‹¤. μ§€μ •μλ” λ‹¤μκ³Ό κ°™λ‹¤.

### `execution`

λ©”μ†λ“ μ‹¤ν–‰ μ΅°μΈν¬μΈνΈλ¥Ό λ§¤μΉμ‹ν‚¤κΈ° μ„ν•΄, μ΄κ²ƒμ€ μ¤ν”„λ§ AOP λ΅ μ‘μ—… ν•  λ• μ‚¬μ©ν•  κΈ°λ³Έ ν¬μΈνΈμ»· μ§€μ •μμ΄λ‹¤.

### `within`

νΉμ • νƒ€μ…λ‚΄μ—μ„ μ΅°μΈν¬μΈνΈμ™€ μΌμΉν•λ” ν•κ³„. (μ΅°μΈν¬μΈνΈ: μ¤ν”„λ§ AOP λ¥Ό μ‚¬μ©ν•  λ• λ‹¨μν μΌμΉν•λ” νƒ€μ…λ‚΄μ—μ„ μ„ μ–Έ λ λ©”μ†λ“μ μ‹¤ν–‰)

### `this`

λΉ μ°Έμ΅°κ°€ μ£Όμ–΄μ§„ νƒ€μ…μ μΈμ¤ν„΄μ¤μΈ μ΅°μΈν¬μΈνΈμ™€ μΌμΉν•λ” ν•κ³„. (λΉ μ°Έμ΅°: μ¤ν”„λ§ AOP proxy) (μ΅°μΈν¬μΈνΈ: μ¤ν”„λ§ AOPλ¥Ό μ‚¬μ©ν•  λ• λ©”μ†λ“μ μ‹¤ν–‰)

### `target`

μ΅°μΈν¬μΈνΈμ— μΌμΉν•λ” ν•κ³„ λ€μƒ κ°μ²΄κ°€ μ£Όμ–΄μ§„ νƒ€μ…μ μΈμ¤ν„΄μ¤μΈ κ²½μ°. (μ΅°μΈν¬μΈνΈ: μ¤ν”„λ§ AOP λ¥Ό μ‚¬μ©ν•  λ• λ©”μ†λ“ μ‹¤ν–‰) (λ€μƒ κ°μ²΄: ν”„λ΅μ‹λ  μ• ν”λ¦¬μΌ€μ΄μ… κ°μ²΄)

### `args`

μ΅°μΈν¬μΈνΈμ— μΌμΉν•λ” μ ν•. (μ΅°μΈν¬μΈνΈ: μ¤ν”„λ§ AOP μ„ μ‚¬μ©ν•  λ• λ©”μ†λ“ μ‹¤ν–‰) μΈμλ” μ£Όμ–΄μ§„ νƒ€μ…μ μΈμ¤ν„΄μ¤μ΄λ‹¤.

### `@target`

μ‹¤ν–‰ κ°μ²΄μ ν΄λμ¤κ°€ μ£Όμ–΄μ§„ νƒ€μ…μ μ–΄λ…Έν…μ΄μ…μ„ κ°€μ§€κ³  μλ” μ΅°μΈν¬μΈνΈ μ™€ μΌμΉν•λ” ν•κ³„. (μ΅°μΈν¬μΈνΈ: μ¤ν”„λ§ AOP λ¥Ό μ‚¬μ©ν•  λ• λ©”μ†λ“μ μ‹¤ν–‰)

### `@args`

μ‹¤μ  μΈμμ λ°νƒ€μ„ νƒ€μ…μ΄ μ£Όμ–΄μ§„ νƒ€μ…μ μ–΄λ…Έν…μ΄μ…μ„ κ°€μ§€κ³ μλ” μ΅°μΈν¬μΈνΈμ™€ μΌμΉν•λ” ν•κ³„. (μ΅°μΈν¬μΈνΈ: μ¤ν”„λ§ AOPλ¥Ό μ‚¬μ©ν•  λ• λ©”μ†λ“μ μ‹¤ν–‰)

### `@within`

μ£Όμ–΄μ§„ μ–΄λ…Έν…μ΄μ…λ‚΄μ—μ„ μ΅°μΈν¬μΈνΈμ™€ μΌμΉν•λ” ν•κ³„. (μ¤ν”„λ§ AOP μ„ μ‚¬μ©ν•  λ• μ£Όμ–΄μ§„ μ–΄λ…Έν…μ΄μ…μΌλ΅ νƒ€μ…μ—μ„ μ„ μ–Έλ λ©”μ†λ“μ μ‹¤ν–‰)

### `@annotation`

μ΅°μΈν¬μΈνΈμ μ£Όμ²΄κ°€ μ£Όμ–΄μ§„ μ–΄λ…Έν…μ΄μ…μ„ κ°–λ” μ΅°μΈ ν¬μΈνΈμ™€ μΌμΉν•λ” ν•κ³„. (μ¤ν”„λ§ AOP μ—μ„ μ‹¤ν–‰λλ” λ©”μ†λ“)

> ## Note
>
> μ¤ν”„λ§μ AOP μ ν”„λ΅μ‹ κΈ°λ° νΉμ„±μΌλ΅ μΈν•΄ protected λ©”μ†λ“λ” μ •μμ— μν•΄ μ°¨λ‹¨λμ§€ μ•μΌλ©° JDK ν”„λ΅μ‹ (μ μ©ν•  μ μ—†λ” κ²½μ°) λ‚ CGLIB ν”„λ΅μ‹ (κΈ°μ μ μΌλ΅λ” κ°€λ¥ν•μ§€λ§ AOP μ©λ„λ΅λ” κ¶μ¥λμ§€ μ•μ) μ—λ” μ‚¬μ©ν•  μ μ—†λ‹¤. κ²°κ³Όμ μΌλ΅ μ£Όμ–΄μ§„ ν¬μΈνΈμ»· μ€ public λ©”μ†λ“μ™€λ§ μΌμΉν•λ‹¤!
>
> μΈν„°μ…‰ν„°μ— protected / private λ©”μ†λ“ λλ” μƒμ„±μκ°€ ν•„μ”ν• κ²½μ° μ¤ν”„λ§μ ν”„λ΅μ‹ κΈ°λ° AOP κ°€ μ•„λ‹ μ¤ν”„λ§ κΈ°λ° λ„¤μ΄ν‹°λΈ AspectJ μ„λΉ™μ μ‚¬μ©μ„ κ³ λ ¤ν•λΌ. μ΄κ²ƒμ€ λ‹¤μ–‘ν• νΉμ„±μ„ κ°€μ§„ AOP μ‚¬μ©μ λ‹¤λ¥Έ λ¨λ“λ¥Ό κµ¬μ„±ν•κΈ° λ•λ¬Έμ— κ²°μ •ν•κΈ° μ „μ— λ¨Όμ € μ„λΉ™μ— μµμ™ν•΄μ Έμ•Όν•λ‹¤.

*****

## ν•™μµ λ‚΄μ© μ°Έκ³  μ¶μ²

- [Spring document](https://docs.spring.io/autorepo/docs/spring-framework/5.0.0.M1/spring-framework-reference/pdf/spring-framework-reference.pdf)
- [[10λ¶„ ν…μ½”ν†΅] π•μ μ΄μ Spring AOP](https://www.youtube.com/watch?v=Hm0w_9ngDpM)
