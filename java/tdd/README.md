# TDD

- 테스트한다는 것은 무엇을 뜻하는가?
- 테스트를 언제 해야 하는가?
- 테스트할 로직을 어떻게 고를 것인가?
- 테스트할 데이터를 어떻게 고를 것인가?

## 양성 피드백 고리

1. 스트레스를 많이 받으면 테스트를 점점 뜸하게 하게된다.
2. 테스트를 뜸하게 하면 생산 코드에 에러가 많아지게 된다.
3. 에러가 많아지면 더 많은 스트레스를 받는다.

## 테스트 작성 리듬

1. 재빨리 테스트를 하나 추가한다.
2. 모든 테스트를 실행하고 새로 추가한 것이 실패하는지 확인한다.
3. 코드를 조금 바꾼다.
4. 모든 테스트를 실행하고 전부 성공하는지 확인한다.
5. 리팩토링을 통해 중복을 제거한다.

### 단언 우선

테스트를 작성할 때 단언(assert)을 제일 먼저 작성하고 시작하라.

- 시스템 개발시 무슨 일부터 하는가? 완료된 시스템이 주는 결과를 알려주는 이야기부터 작성한다.
- 특정 기능을 개발할 때 무슨 일부터 하는가? 기능이 완료되면 통과할 수 있는 테스트부터 작성한다.
- 테스트를 개발할 때 무슨 일부터 하는가? 완료될 때 통과해야 할 단언부터 작성한다.

## 최종 검토

- 테스트를 확실하게 돌아가게 만드는 세 가지 접근법: 가짜로 구현하기, 삼각측량법, 명백하게 구현하기.
- 설계를 주도하기 위한 방법으로 테스트 코드와 실제 코드 사이의 중복을 제거
- 길이 미끄러우면 속도를 줄이고 상황이 좋으면 속도를 높이는 식의 테스트 사이의 간격 조정 능력.

- - -

# SLASH 21 - 테스트 커버리지 100%

[토스ㅣSLASH 21 - 테스트 커버리지 100%](https://www.youtube.com/watch?v=jdlBu2vFv58)

## 테스트 커버리지의 이점

- 자신있게 누를 수 있는 배포 버튼
  - 코드가 테스트되었다는 사실에서 오는 자신감
- 거침없는 리팩토링
  - 리팩토링에서 발생한 문제를 테스트 코드가 알려줌
- 불필요한 프로덕션 코드가 사라진다.
  - 남아있는 프로덕션 코드는 테스트 코드를 작성해야한다.
- 프로덕션 코드에 대한 이해도가 높아진다.
  - 동작을 이해해야 테스트 코드를 작성한다.
- 점진적으로 테스트코드 작성이 쉬워진다.
  - 이전 작성한 테스트를 참고해 새 테스트를 작성할 수 있다.

### 테스트 커버리지를 높이기 위한 요소

- 믿음

1. 테스트 코드가 없으면 리팩토링 할 수 없고,
2. 리팩토링 하지 않은 코드는 이해할 수 없으며,
3. 이해할 수 없는 코드는 수정할 수 없다.

그리고 어떤 코드든 테스트할 수 있다는 믿음이다.

- 시간

테스트 코드를 작성하는 물리적인 시간. 초기부터 끌어올리는게 바람직함. (유지기간이 길어질수록 복잡도가 증가함)

## 느려지는 테스트 극복하기

> 테스트 케이스가 많아지면서 테스트 속도가 느려진다. 이는 생산성 저하를 가져온다. (배포/테스트마다 시간 소요)

### 스프링 애플리케이션 컨텍스트 로딩

> 첫 번째 원인은 **스프링 애플리케이션 컨텍스트 로딩**

해당 원인을 아예 제거해버렸고, `WebTestClient` 로 컨텍스트 로딩 없이 테스트한다.

또한 스프링 애플리케이션 기동 자체는 모킹 라이브러리의 스태틱 모킹 기능을 사용해 스프링을 모킹해 기동하는 것으로 해결하였다.

### 프로파일링 도구 사용

인텔리제이를 사용하여 느려지는 원인 분석.

### 장비 개선

> **돈이 최고**

## 진짜 어려운 테스트 코드

### 바이트 코드가 생성한 코드에 대한 테스트 코드

> 얻는 것보다, 시간적인 소모가 큰 경우 커버리지에서 제외하기.

## 버그

### 테스트를 잘못 작성한 경우

Mutation Testing : (pitest.org) 프로덕션 코드를 무작위로 조작. 테스트가 통과하면 테스트 케이스가 부족한 것. .... **굉장히 느리니 중요한 포인트에만 사용할 것**

### 요구사항을 잘못 인지한 경우

테스트로 스펙 문서 만들기

JUnit5 TestExecutionListener : 테스트 이름을 수집하여 마크다운 형식의 스펙문서 생성.

다만 보기 좋은 문서를 만들려면 상당한 노력이 필요한데, 문서를 유지하기 어려움.

### 컴포넌트간에 협업이 실패할 경우

다른 API 가 버그를 가져 컴포넌트 협업에 실패한 경우이다.

Consumer Driven Contracts ... spring-cloud-contract 와 Pact
