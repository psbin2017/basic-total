# ✨ 아이템 86: `Serializable` 을 구현할지는 신중히 결정하라

## 수정 문제

> `Serializable` 을 구현하면 릴리스하고 난 뒤에는 수정하기 매우 어렵다. 이 클래스가 널리 퍼지면 영원히 지원해야 한다.

필드 접근 최소화 등의 앞서 본 아이템들이 전부 무력화되며, 다시 손 보려고 한다면 지저분한 소스 코드를 남길 것이다. 이를 누리고자 한다면 고품질의 직렬화 형태를 가지도록 설계해야 한다. 초기 비용은 비싸지만 보상은 두둑하다.

## 보안 문제

> `Serializable` 는 버그와 보안 구멍이 생길 위험이 높아진다.

역직렬화는 일반 생성자의 문제가 그대로 적용되는 '숨은 생성자'다. 기본 역직렬화를 사용하면 불변식 깨짐과 허가되지 않은 접근에 쉽게 노출된다는 뜻이다.

## 테스트 문제

> `Serializable` 는 해당 클래스의 신버전을 릴리스할 때 테스트할 것이 늘어난다.

신버전 인스턴스가 구버전으로 역직렬화 가능한지? 그리고 그 반대로도 가능한지를 테스트해야한다.

## 정리

1. 따라서 `Serializable` 구현하는 여부는 가볍게 결정해야하는 사안이 아니고 중대한 사안이다.
2. 상속도 마찬가지고 인터페이스도 대부분 확장해선 안된다.

구현해야 한다면 하위 클래스에서 finalize 메소드를 재정의하지 못하게 해야한다. 인스턴스 필드 중 기본값으로 초기화되면 위배되는 불변식이 있다면 클래스의 `readObjectNoData` 메소드를 추가해야 한다.

```java
private void readObjectNoData() throws InvalidObjectException() {
    throw new InvalidObjectException("스트림 데이터가 필요합니다.");
}
```

마지막으로 내부 클래스는 직렬화를 구현하지 말자.
