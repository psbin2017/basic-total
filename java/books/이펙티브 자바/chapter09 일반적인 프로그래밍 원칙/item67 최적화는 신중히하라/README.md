# ✨ 아이템 67: 최적화는 신중히하라

> (맹목적인 어리석음을 포함해) 그 어떤 핑계보다 효율성이라는 이름 아래 행해진 컴퓨팅 죄악이 더 많다. (심지어 효율을 높이지 못하면서). - 윌리엄 울프
>
> (전체의 97% 정도인) 자그마한 효율성은 모두 잊자. 섣부른 최적화가 만악의 근원이다. - 도널드 크누스
>
> 최적화를 할때는 다음 두 규칙을 따르라. 첫 번째, 하지 마라. 두 번째, (전문가 한정) 아직 하지마라. 다시 말해, 완전히 명백하고 최적화되지 않은 해법을 찾을때까지는 하지 마라. - M. A. 잭슨

최적화는 잘못하면 빠르지도 않고 제대로 동작하지 않으면서 수정하기는 어려운 소프트웨어를 탄생시킨다.

1. 빠른 프로그램보다는 좋은 프로그램을 작성하자.
   - 원하는 성능이 나오지 않는다면 아키텍처 자체가 최적화할 수 있는 길을 안내해줄 것이다.
2. 성능을 제한하는 설계를 피하라.
   - 완성 후 변경하기 어려운 설계 요소는 컴포넌트 끼리, 외부 시스템과의 소통 방식이다. 변경이 어렵고 불가능할 수 있다.
3. API 를 설계할 때 성능에 주는 영향을 고려하라.
   - public 타입을 가변으로 만들면 방어적 복사를 수없이 유발해야 한다.
   - 컴포지션으로 해결할 수 있음에도 상속 방식으로 설계시 영원히 종속되며 성능 제약까지 줄줄이 소시지가 된다.
   - 인터페이스가 있는데 구현 타입을 사용하는 것도 좋지 않다. 특정 구현체에 종속된다.
4. 성능을 위해 API 를 왜곡하는 건 안좋은 생각이다.
   - 왜곡된 API 와 이를 지원하는 데 따르는 고통은 영원하다.
5. 각각의 최적화시도 전후로 성능을 측정하라.
   - 눈에 띄게 높아지지 않는 경우가 많고, 나빠질 때도 있다. 느릴꺼라 짐작한 부분은 사실 성능에 영향을 주지 않는 곳이라면 시간만 허비한 셈이 된다.
   - 프로파일링 도구들은 최적화에 대한 노력을 어디에 집중해야할 지 모르는 상황일 때 길잡이가 된다.

## 정리

빠른 프로그램을 작성하려 안달하지 말자. 좋은 프로그램을 작성하다보면 성능은 따라온다.

시스템 설계시 API, 네트워크 프로토콜, 영구 저장용 데이터 포맷을 설계시 성능을 염두에 두어야한다. 시스템 성능을 측정하고 프로파일링 도구로 최적화 지점을 찾아 수행하라. 우선 어떤 **알고리즘이 적용되어 있는지 살펴보라.** 알고리즘이 개선되지 않으면 다른 저수준의 최적화를 해봤자 소용이 없다.

반복하고 성능을 측정하라.
