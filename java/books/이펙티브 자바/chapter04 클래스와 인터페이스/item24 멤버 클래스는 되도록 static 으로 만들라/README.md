# ✨ 아이템 24: 멤버 클래스는 되도록 static 으로 만들라

중첩 클래스는 다른 클래스 안에 정의된 클래스를 말하며, 자신을 감싼 바깥 클래스에서만 쓰여야 하며, 그 외의 쓰임새가 있다면 톱레벨 클래스로 올려서 만들어야 한다.

- 정적 멤버 클래스
- 비정적 멤커 클래스
- 익명 클래스
- 지역 클래스

총 4 가지로 첫 번째를 제외한 나머지는 모두 내부 클래스에 해당한다.

## 정적 멤버 클래스

다른 클래스 안에 선언되어, 바깥 클래스의 private 멤버에도 접근 가능한 것을 제외하면 일반 클래스와 동일하다. private 로 선언시 바깥 클래스에서만 접근할 수 있다. 이 외로는 public 도우미 클래스로 사용한다. (톱레벨로 작성 가능하다.)

개념상 중첩 클래스의 인스턴스가 바깥 인스턴스와 독립적으로 존재할 수 있다면 정적 멤버 클래스로 만들어야한다.

**멤버 클래스에서 바깥 인스턴스에 접근할 일이 없다면 무조건 static 을 붙여 정적 멤버 클래스로 만들자.**

## 비정적 멤버 클래스

비정적 멤버 클래스의 인스턴스는 바깥 클래스의 인스턴스와 암묵적으로 연결된다. 그래서 비정적 멤버 클래스의 인스턴스 메서드에서 정규화된 this 를 사용하여 바깥 인스턴스의 메서드를 호출하거나 바깥 인스턴스의 참조를 가져올 수 있다. (정규화된 this 란 클래스명.this 형태이다.)

비정적 멤버 클래스의 인스턴스와 바깥 인스턴스 사이의 관계는 멤버 클래스가 인스턴스화 될 때 확립되며, 변경할 수 없다. 이 관계는 보통 바깥 클래스로 만들어지는게 일반적이지만, 드물게 바깥 인스턴스의 `클래스.new MemberClass(arg)` 를 호출해 수동으로 만들기도 한다. (비정적 멤버 클래스의 인스턴스 안에서 만들어져 메모리 공간을 차지하며, 생성시간이 더 걸린다.)

어떤 클래스를 감싸 마치 다른 클래스의 인스턴스처럼 보이게 하는 뷰로 사용할 수 있다. Map 인터페이스의 구현체들은 보통 자신의 컬렉션 뷰를 구현시 비정적 멤버 클래스를 사용한다.

```java
public class MySet<E> extends AbstractSet<E> {
    // ...

    @Override public Iterator<E> iterator() {
        return new MyIterator();
    }

    private class MyIterator implements Iterator<E> {
        // ...
    }
}
```

앞서 생성시간 문제보다 더 심각한 문제는 가비지 컬렉션이 바깥 클래스의 인스턴스를 수거하지 못하는 누수가 발생할 수 있다는 것이다. (임의로 참조를 해제할 수 있는 방법이 없기 때문에)

멤버 클래스의 공개된 클래스의 `public` / `protected` 멤버라면 정적이냐 아니냐는 두 배로 중요해진다. 멤버 클래스가 공개 API 가 되기에 향후 릴리스에서 static 을 붙이면 호환성이 깨진다.

### Map 인스턴스

`private` 정적 멤버 클래스는 흔히 바깥 클래스가 표현하는 객체의 한 부분을 표현할 때 사용한다. `Map` 구현체는 각각의 키-값 쌍을 표현하는 엔트리 객체를 가진다. 엔트리 객체가 맵과 연관되어 있지만 엔트리의 메서드들은 직접 맵을 사용하지 않는다. 따라서 `private` 정적 멤버 클래스가 알맞다.

## 익명 클래스

쓰이는 시점에 선언과 인스턴스가 생성된다. 오직 비정적 문맥에서 사용될 때만 바깥 클래스의 인스턴스를 참조할 수 있다. 정적 문맥에서 상수 변수 이외의 정적 멤버를 가질 수 없다.

선언 시점에 사용하여 instanceof 검사나 클래스 명이 필요한 작업은 수행할 수 없다. 인터페이스 구현이나 상속이 불가능하며 표현식 중간에 등장하므로 짧지 않으면 가독성이 떨어진다.

익명 클래스는 람다를 생각하면 되고 그 외의 주 쓰임새로는 정적 팩터리 메소드를 구현할 때이다.

## 지역 클래스

지역변수를 선언할 수 있는 곳이면 선언하여 사용가능하며 유효 범위도 지역변수와 동일하다. 다른 멤버 클래스처럼 이름이 있고 반복하여 사용이 가능하다.

익명 클래스처럼 비정적 문맥에서 사용될 때만 바깥 클래스의 인스턴스를 참조할 수 있으며, 가독성을 위해 짧게 작성해야 한다.

## 작성 방법 정리

- 메서드 밖에서 사용하고 안에서의 정의가 길다면 *멤버 클래스*
  - 1-1. 작성한 클래스가 바깥 클래스를 참조한다면 **비정적 멤버 클래스**
  - 1-2. 작성한 클래스가 바깥 클래스를 참조하지 않으면 **정적 멤버 클래스**
- 하나의 메서드 안에서만 쓰면서 생성 시점이 단 한 곳이고 해당 타입으로 작성하기에 적합한 클래스나 인터페이스가 이미 있다면 **익명 클래스** 아니라면 **지역 클래스**
