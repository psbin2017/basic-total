# ✨ 아이템 52: 다중정의는 신중히 사용하라

## 의도치않게 실수하게 된다

[SetList](https://github.com/psbin2017/garbage-collection/blob/master/gc/src/test/java/com/collection/gc/sample/method/SetList.java)

조금만 잘 살펴보면 쉽게 해결가능한 부분이지만, 다중정의로 인해 발생한 문제이다.

## 다중 정의의 매개변수는 컴파일 타임 타입에 의해 이루어진다

[CollectionClassifier](https://github.com/psbin2017/garbage-collection/blob/master/gc/src/test/java/com/collection/gc/sample/method/CollectionClassifier.java)

런타임에는 타입이 매번 달라지지만, 호출할 메소드는 컴파일타임에 결정된다. 컴파일타임에서는 for 문의 타입은 `Collection<?>` 이다.

**재정의한 메소드는 동적으로 선택되고, 다중정의한 메소드는 정적으로 선택된다.** 메소드를 재정의했다면 해당 객체의 런타임 타입이 어떤 메소드를 호출할지의 기준이된다.

[Wine](https://github.com/psbin2017/garbage-collection/blob/master/gc/src/test/java/com/collection/gc/sample/method/Wine.java)

위 경우 컴파일타임과 무관하게 가장 하위에서 정의한 메서드가 실행된다. **다중정의는 런타임은 중요하지 않다. 선택은 오직 컴파일 타임에, 오직 매개변수의 컴파일타임 타입에 의해 이루어진다.**

다중정의는 API 사용자가 어떤 메소드를 호출될지를 모른다면 혼동을 일으킨다. **안전하고 보수적으로 간다면 매개변수 수가 같은 다중정의는 만들지 말자.**

가변인수(varargs)를 사용하는 메소드라면 다중정의를 아예하지 말아야한다. 제일 쉬운 방법은 다중정의하는 대신 메소드이름을 다르게 지어주는 길이다.

> `writeInt(int)`, `writeBoolean(boolean)`, `writeLong(long)`

생성자는 이름을 다르게 지을수 없으니 두 번째 생성자 부터 무조건 다중정의가 된다. 그러나 정적 팩토리라는 대안을 활용하는 경우가 많다. 그래도 여러 생성자가 같은 수의 매개변수를 받아야 하는 경우를 다 피해갈수는 없으니 안전 대책을 배워두면 도움이 된다.

## 자바 8

람다와 메소드 참조도 다중 정의시 혼란을 키웠다. 메소드를 다중정의할 때, 서로 다른 함수형 인터페이스라도 같은 위치의 인수로 받아서는 안된다. 이 뜻은 서로 다른 함수형 인터페이스라도 서로 근본적으로 다르지 않다는 뜻을 의미한다.

## 다중정의의 복잡도

클래스가 시간이 지나면서 버전업되면서 다중정의의 선택은 더욱 복잡해질 수 있다. 이는 자바 API 에서도 겪는 문제이다. 그러나 어떤 다중정의 메소드가 불리는지 몰라도 기능이 똑같다면 신경쓸게 없다. 이렇게 하는 가장 일반적인 방법은 상대적으로 더 특수한 다중정의 메소드에서 덜 특수한 일반적인 다중 정의 메소드로 일을 넘겨버리는 방법이 있다.

## 정리

1. 언어가 다중정의를 허용한다해도 다중정의를 활용하라는 뜻은 아니다.
2. 매개변수 수가 같다면 더더욱 피해야 한다.
3. 생성자는 다중정의를 피하기 어렵다. 그러나 정적 팩토리 같은 해결 방법이 있다.
4. 헷갈릴만한 매개변수는 형변환하여 정확한 다중정의를 선택하도록 제공해야한다.
