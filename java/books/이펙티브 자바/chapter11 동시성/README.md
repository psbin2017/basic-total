# 💎 11장: 동시성

> 스레드는 여러 활동을 동시에 수행할 수 있게 해준다.

그러나 동시성 프로그래밍(멀티스레드 프로그래밍)은 단일 스레드 프로그래밍보다 어렵다.

1. 잘못될 수 있는 일이 늘어난다.
2. 문제를 재현하기도 어렵다.

그러나 **언제까지나 도망다닐 수 없다.** 멀티 코어 프로세서의 힘을 제대로 활용하려면 반드시 내 것으로 만들어야 하는 기술이다.

## 동기화

> 동기화는 배타적 실행뿐 아니라 스레드 사이의 안정적인 통신에 꼭 필요하다.

### 배타적 실행

> 동기화는 일관성이 깨진 상태를 볼 수 없으며, 동기화된 메소드나 블록에 들어간 스레드가 같은 락의 보호하에 수행된 모든 이전 수정의 최종 결과를 보게 해준다.

1. (A Thread) → [(B Method/Block)] → [(B Method/Block A Thread changed)]
2. (C Thread) → **[(B Method/Block A Thread changed)]** → ...

### 통신

스레드가 필드를 읽을 때 **항상 '수정이 완전히 반영된' 값을 얻는다고 보장**하지만, 한 스레드가 **저장한 값이 다른 스레드에게 '보이는가'는 보장하지 않는다.**

## 가변 데이터 공유

> 여러 스레드가 가변 데이터를 공유한다면 그 데이터를 읽고 쓰는 동작은 반드시 동기화해야 한다.

- 가변 데이터는 단일 스레드에서만 쓰도록 노력하자. (정책상 정해졌다면, 문서화하자)
- 읽고 쓰는 메소드를 `synchronized` 사용하는게 가장 쉬운 방법.
- `volatile` 한정자를 사용하는 방법도 있지만, 잘못 사용시 안전 실패를 유발한다.
- `java.util.concurrent.atomic` 패키지 사용하자.
