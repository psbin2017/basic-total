# 💎 2장 객체의 생성과 파괴

학습 내용 출처: [이펙티브 자바 3판](http://ebook.insightbook.co.kr/book/66)

본 챕터의 공통 주제는 다음과 같다.

1. 객체를 만들어야할 때와 만들지 않아야 할 때에 대한 구분
2. 올바른 객체 생성 방법
3. 불필요한 객체 생성을 피하는 방법
4. 객체의 파괴를 보장하며 객체 파괴 이전에 수행해야 할 작업을 관리하는 방법

## ✨ 아이템 7: 다 쓴 객체 참조를 해제하라

```java
public Object pop() {
    if (size == 0) {
        throw new EmptyStackException();
    }
    Object result = elements[--size];
    elements[size] = null; // 다 쓴 참조 해제
    return result;
}
```

참조를 다 썼을 때 null 처리로 참조를 해제한다. 메모리 누수를 해소하며 null 처리한 참조를 실수로 사용하려 하면 `NullPointerException` 을 던지는 오류를 조기 발견할 수 있다.

단, 객체 참조를 null 처리하는 일은 예외적인 경우여야 하며 참조를 해제하는 가장 좋은 방법은 그 참초를 담은 변수를 유효 범위(scope)밖으로 밀어내는 것이다.

`Stack` 클래스가 메모리 누수의 취약한 이유는 객체의 메모리를 직접 관리하기 때문이다. 따라서 자기 메모리를 직접 관리하는 클래스라면 프로그래머는 항시 메모리 누수에 유의해야한다. (다 사용한 객체를 null 처리)

캐시 역시 메모리 누수를 일으키는 주범이다. 시간이 지날수록 엔트리의 가치를 떨어뜨리는 방식인 `WeakHashMap` 이 있다. 즉, 사용하지 않는 엔트리를 이따금 청소해주어야 한다.

마지막으로 리스너 혹은 콜벡이라 부르는 것으로 클라이언트가 등록만하고 명확하게 해지하지 않는 경우를 말한다. 뭔가 조치를 하지 않으면 천천히 계속 콜백이 쌓여간다. 이럴 때 콜백을 약한 참조로 저장하면 가비지 컬렉터가 수거할 것이다. (`WeakHashMap`)
