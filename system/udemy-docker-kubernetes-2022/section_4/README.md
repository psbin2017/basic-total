# 섹션 4 네트워킹: 컨테이너 통신

HTTP 요청을 다른 웹사이트나 웹 API 로 전송하는 방법을 배운다.

## 로컬 호스트 내의 컨테이너와 통신

`localhost` 에서 `host.docker.internal` 로 변경한다.

- `mongodb://host.docker.internal:27017`
- `http://host.docker.internal:8081`

`host.docker.internal` 는 로컬 호스트 머신의 IP 주소로 변환된다. (도커가 알아서 처리한다.)

## 컨테어너 간의 통신 (기본)

실행되어있는 컨테이너의 IP 주소를 알아낸다. (`docker container inspect`) 해당 IP 주소를 복사하여 적용한다. 매번 IP 주소를 알아내야 된다는 불편함이 존재한다.

## Docker Networks

> `docker network create my-network`

컨테이너간 통신을 위해서 네트워크를 생성한다. 컨테이너를 실행 할 때 `--network my-network` 플래그를 준다.

플래그로 실행된 컨테이너는 이제 IP 도 `host.docker.internal` 도 아닌 실행시 부여한 이름으로 식별된다. `docker run -d --name mongodb --network my-network` 라면 `my-network` 에서는 `mongodb` 로 통신할 수 있다.

추가로 외부에 포트를 노출시킬 필요가 없는 서비스라면 `-p` 옵션을 부여하지 않아도 된다. 같은 네트워크에서 참가 되어있다면 해당 컨테이너는 접근 가능하나 외부에서 호출할 때는 접근이 불가능해진다. (즉, 노출된 애플리케이션만 접근되니 자연스럽게 외부망과 격리되어서 좋음.)

도커는 애플리케이션이 실행되는 환경을 가지고 애플리케이션이 다른 컨테이너에 요청을 보내는 것을 인식하여 주소, 컨테이너 이름 또는 `host.docker.internal` 을 실제 IP 주소로 변경한다. (도커는 주변 컨테이너의  실행을 알고 있다.)

## 도커 네트워크 드라이버

도커는 실제로 네트워크 동작에 영향을 미치는 다양한 드라이버를 지원한다. 기본 드라이버는 브리지 드라이버이며 해당 드라이버는 모듈에 나타난 동작을 제공한다.

네트워크 생성시에 `--driver` 옵션을 주어 설정이 가능하다. (대다수의 시나리오에서는 기본인 브리지가 적합하다.)

- `host`: 스탠드얼론 컨테이너의 경우, 컨테이너와 호스트 시스템 간의 격리가 제거된다. localhost 를 네트워크로 공유한다.
- `overlay`: 여러 Docker 데몬 (즉, 서로 다른 머신에서 실행되는 Docker)이 서로 연결될 수 있다. 여러 컨테이너를 연결하는 구식의 / 거의 사용되지 않는 방법인 'Swarm' 모드에서만 작동한다.
- `macvlan`: 컨테이너에 커스텀 MAC 주소를 설정할 수 있다. 그러면 이 주소를 해당 컨테이너와 통신하는데 사용할 수 있다.
- `none`: 모든 네트워킹이 비활성화된다.
- `써드파티 플러그인`: 모든 종류의 동작과 기능을 추가할 수 있는 타사 플러그인을 설치할 수 있다.

## 네트워크 명령어

### `docker network`

- `create ${name}` : 네트워크를 생성한다
- `ls` : 네트워크를 조회한다.
- `--driver OPTIONS` : 드라이버 옵션을 설정한다.

네트워크에 참여하기위해서는 컨테이너 실행시 `--network ${name}` 으로 네트워크를 부여한다.
