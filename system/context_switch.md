# 문맥 교환

> **Context Swiching**

하나의 프로세스가 CPU 를 사용 중인 상태(점유한다)에서 다른 프로세스가 CPU 를 사용할 수 있도록 하기 위해, 이전 프로세스의 상태(문맥)를 보관하고 새로운 프로세스의 상태를 적재하는 작업이다.

이 프로세스의 문맥은 해당 프로세스 제어 블록에 적재되어 기록되어 있다.

**문맥을 교환하는 과정에서는 해당 CPU 는 다른 작업을 수행할 수 없다.** 이 교환 과정에서 드는 수행시간을 오버헤드라고 한다. 문맥 교환 발생 빈도에 따라 오버헤드가 증가하기 때문에 성능에 영향을 끼친다.

## 프로세스 제어 블록 (PCB)

특정한 프로세스를 관리할 필요가 있느 정보를 포함하는 운영 체제 커널의 자료구조이다. 작업 제어 블록(TCB) 또는 작업 구조라고도 한다.

운영 체제마다 다르겠지만 일반적으로는 다음 정보가 포함된다

- 프로세스 식별자 (Process ID)
- 프로세스 상태 (Process State): 준비, 실행, 대기, 완료
- 프로그램 계수기: 해당 프로세스 다음에 실행할 명령어의 주소를 가리킨다.
- CPU 레지스터 및 일반 레지스터
- CPU 스케줄링 정보: 우선 순위, 최종 실행시각, CPU 점유시간 등
- 메모리 관리 정보: 해당 프로세스의 주소 공간 등
- 프로세스 계정 정보: 페이지 테이블, 스케줄링 큐 포인터, 소유자, 부모 등
- 입출력 상태 정보: 프로세스에 할당된 입출력장치 목록, 열린 파일 목록 등

## 문맥 교환 시점

컨텍스트 스위칭은 멀티태스킹, 인터럽트 핸들링, 사용자 모드와 커널 모드간의 전환 등으로 인하여 발생한다.

이 중 인터럽트의 자세한 상황은 다음이 될 수 있다.

- 입출력 요청 (I/O interrupt)
- CPU 사용기간 만료 (time slice expired)
- 자식 프로세스를 만들 때(fork a child)
- 인터럽트 처리를 기다릴 때(wait for an interrupt)

## 스레드

하나의 프로세스는 하나 이상의 스레드를 가진다. 여러의 스레드를 가지는 것을 멀티 스레드라고 한다.

**스레드는 프로세스보다 컨텍스트 스위칭이 빠른데 스레드는 프로세스의 가상 메모리 영역을 공유하여 사용하기 때문이다.**

### 멀티 스레드

프로세스가 여러 개의 스레드를 작업하는 기법이다. 여러 개의 스레드를 사용하면 직렬적 처리가 아닌 병렬적 처리가 가능해져 CPU 의 유휴시간을 짧게 가질 수 있게 된다.

그러나 스레드의 개수를 무작정 늘린다해서 N 배의 효율을 가져오는 것이 아니다. 적절한 스레드의 개수를 지정하는 것이 멀티 스레드의 핵심 과제라고 할 수 있다.

## 캐시

캐시는 CPU 와 메인 메모리의 사이에 위치하는 메모리이다. 프로세스가 메인 메모리의 접근하는 빈도수를 줄이기 위해서 데이터를 캐시 메모리에 넣는다.

> 요청 → 캐시 메모리 조회(있는 경우 반환) → 메인 메모리 조회

프로세스 컨텍스트 스위칭이 발생하면 운영 체제 커널에 대한 제어권을 넘겨주는 것을 포함한다. 뿐만 아니라 메모리 영역에 대한 전환을 포함한다. 이는 캐시를 플러시 하는것을 의미한다.

> (프로세스 스위칭) → 요청 → 캐시 메모리 조회(플러시되어 비어있음) → 메인 메모리 조회

## 학습내용 참고 내용

- [문맥 교환](https://ko.wikipedia.org/wiki/%EB%AC%B8%EB%A7%A5_%EA%B5%90%ED%99%98)
- [프로세스 제어 블록](https://ko.wikipedia.org/wiki/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4_%EC%A0%9C%EC%96%B4_%EB%B8%94%EB%A1%9D)
- [CPU 캐시](https://ko.wikipedia.org/wiki/CPU_%EC%BA%90%EC%8B%9C)
- [프로세스, 스레드의 컨텍스트 스위칭 cpu와의 관계](https://junshock5.tistory.com/117?category=758386)
- [Thread context switch Vs. process context switch](https://stackoverflow.com/questions/5440128/thread-context-switch-vs-process-context-switch)
