# 웹 프로세스 이해

> [최범균의 JSP 웹 프로그래밍 2.2](http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9788980782802) 를 기준으로 작성하였습니다.

 웹 브라우저에 주소를 입력하여 웹 애플리케이션에 기능을 요청한다. 요청 받은 기능에 맞게 결과를 생성하여 웹 브라우저에 전송한다. 요청한 기능을 제공하기 위해서는 웹 서버, 애플리케이션 서버 그리고 데이터베이스와 같은 구성 요소들을 필요로 한다.

## 웹 서버

 주로 정적인 HTML, 이미지, CSS, 자바 스크립트 파일을 웹 브라우저에 제공할 때 웹 서버를 사용한다. (예 : 아파치, nginx 등)

## 애플리케이션 서버

 게시글 목록, 로그인 처리와 같은 기능을 실행하고 응답으로 웹서버에 전달한다. (예 : 톰캣, JBOSS 등)

## 데이터베이스

 웹 애플리케이션이 필요로 하는 회원정보, 게시판 글 데이터와 같은 데이터를 저장한다. (예 : Oracle, MySQL, MSSQL 등)

## 웹 브라우저

 웹 서버에 서비스 실행을 요청하며, 웹 서버의 처리 결과를 사용자에게 보여준다. (예 : 인터넷 익스플로러, 구글 크롬, 파이어폭스 등)

 애플리케이션 서버도 웹 서버와 마찬가지로 정적 내용을 제공할 수 있다.

# 웹 애플리케이션 동작 방식

웹 서버가 웹 애플리케이션 프로그램을 실행하는 방식에 따라서 2가지 형태로 구분 할 수 있다.

## CGI 방식

 [CGI(Common Gateway Interface)](https://ko.wikipedia.org/wiki/%EA%B3%B5%EC%9A%A9_%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4_%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4) 방식이란, 웹 서버가 웹 애플리케이션 프로그램을 직접 호출하는 실행 구조를 갖는다. 펄/C/C++로 작성된 CGI 프로그램을 직접 실행하고, 프로그램 생성 결과를 브라우저에게 전송한다.

## WAS 방식

 [WAS (Web Application Server)](https://ko.wikipedia.org/wiki/%EC%9B%B9_%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98_%EC%84%9C%EB%B2%84) 방식이란, 웹 서버가 직접 프로그램을 호출하기 보다는 웹 애플리케이션 서버를 통해서 간접적으로 웹 애플리케이션 프로그램을 실행한다. JSP, ASP.net 은 모두 해당 방식이다.

> **WAS 는 CGI 보다 트래픽 처리에 대한 성능이 뛰어나다.**

CGI 방식은 웹브라우저의 요청 개수가 많아질수록 웹 서버가 사용하는 메모리도 증가한다. WAS 방식은 웹 브라우저의 요청 개수가 많아져도 한 개의 메모리만 사용하기 때문에 전체적인 사용량이 적다.

# 웹 애플리케이션 구현 방식

 웹 애플리케이션을 구현하는 방식에 따라 2가지 형태로 구분 할 수 있다.

## 실행 코드 방식

컴파일 된 실행 프로그램
컴파일 된 기계어 코드 직접 실행
소스 코드를 다시 컴파일 해야 한다.
C 기반의 CGI 프로그램

## 스크립트 방식

컴파일 되지 않은 스크립트
스크립트 코드를 해석 한 뒤 실행
스크립트 코드만 고치면 됨
JSP, ASP.net, PHP, Ruby 등

 스크립트 방식은 스크립트 코드가 번역이 필요하기 때문에 실행 방식에 차이가 있다.

# URL 과 웹 애플리케이션 주소

```text
http://java.sun.com/javase/6/docs/api/index.html
[프로토콜]://[호스트][:포트][경로][파일명][.확장자][쿼리문자열]
```

1. 프로토콜 : 상호간의 통신을 위한 약속된 규약 (TCP/IP)
2. 포트 : 각 서버는 고유의 포트번호를 이용하여 서비스를 제공한다.
3. 경로 : / 문자로 시작하며 마지막 / 문자를 이용해서 파일명.확장자를 구분한다.
4. 쿼리문자열 : 파라미터라고 불리는 데이터를 웹 애플리케이션에 전달할 때 사용한다.?를 이용하여 경로 구분과 구분되며 1개 이상의 파라미터와 이름과 값을 갖는다.

# 서블릿 (Servlet)

 자바 언어를 개발한 곳에서 웹 개발을 위해 만든 표준이 서블릿이다. 서블릿은 앞서 설명한 실행 코드 방식에 속하며 실행 코드 방식의 단점을 해결한 것이 스크립트 방식을 도입한 JSP(Java Server Page) 이다. JSP 표준은 서블릿 표준을 기반으로 하여 만들어졌다. 따라서 서블릿에 의존하고 있기 때문에 서블릿에 대한 이해가 필요하다.

## Server + Applet 의 합성어

* 서블릿 클래스 : 브라우저를 통해 자바 클래스가 실행되도록 하기 위해서 javax.servlet.http 패키지에서 제공하는 HttpServlet 클래스를 상속받아 구현해야한다.

## 서블릿 동작 원리

 톰캣이 구동되면 JVM이 구동되어 자바 문법을 따르는 서블릿을 처리할 수 있는 환경이 제공된다.

## 서블릿 컨테이너

 웹 서버와 서블릿 사이의 통신을 지원하며 서블릿의 생명 주기를 관리한다. 새로운 요청이 들어올 때 마다 자바 스레드를 생성해서 사용자의 요청을 처리한다. 컨테이너는 선언적인 방법으로 보안관련 내용을 설정할 수 있다.

## 서블릿 라이프 사이클

 클라이언트의 첫 번째 요청인 경우, 서블릿 클래스를 찾아 메모리에 객체를 생성. 이후 인스턴스화된 서블릿 객체는 메모리에 남게 되어 재호출시 이미 로딩된 서블릿 서비스를 받게된다.

> init() -> doGet() 혹은 doPost() -> destroy()

# JSP (Java Server Side Page)

 자바 언어를 기반으로 하는 스크립트 언어로서 자바가 제공하는 기능을 그대로 사용 할 수 있다. HTTP와 같은 프로토콜에 따라 클라이언트의 요청을 처리하고 응답한다. HTML, XML 등 클라이언트가 요청한 문서를 생성하는 데 주로 사용된다.

 서블릿/EJB 등 엔터프라이즈 기술들과 잘 융합 된다. 표현언어, 표현식, 스크립트릿 등 다양한 스크립트 요소와 액션 태그 등을 제공함으로써 보다 쉽게 웹 애플리케이션 프로그래밍을 할 수 있도록 도와준다.

 JSP는 HTTP 프로토콜을 알맞게 처리 할 수 있도록 설계되었다. 또한 사용자 세션을 쉽게 관리할 수 있도록 자체적으로 세션 기능을 제공하고 있다. 최근 사이트의 정보를 XML이나 JSON 형식으로 전송해주는 서비스를 제공하는 곳이 늘어나고 있는 추세인데 JSP를 사용해서 쉽게 생성할 수 있다.

## JSP 라이프사이클

 컴파일 (JSP 구문 분석, 서블릿으로 JSP 변환, 서블릿 컴파일) -> 초기화 -> 실행 -> 정리

# 웹 컨테이너

 웹 컨테이너란(JSP 컨테이너 + 서블릿 컨테이너) 웹 애플리케이션을 실행 할 수 있는 컨테이너다. 자바 언어를 기반으로 하고 있기 때문에 플랫폼에 상관 없이 사용 할 수 있다. 대규모 애플리케이션을 구현할 때 사용되는 스프링 프레임워크와 완벽하게 연동되며, 금융권에서 많이 사용되는 다른 엔터프라이즈 기술과도 완벽하게 연동된다.

# 컨테이너 이해하기

톰캣 기준

1. bin : 톰캣을 실행하고 종료시키는 스크립트(.bat이나 .sh) 파일이 위치해 있다.
2. conf : server.xml 파일을 포함한 톰캣 설정 파일이 위치하고 있다.
3. lib : 톰캣을 실행하는 데 필요한 라이브러리(.jar) 파일이 위치해 있다.
4. logs : 톰캣 로그 파일이 위치한다.
5. temp : 톰캣이 실행되는 동안 임시파일이 위치한다.
6. webapps : 웹 애플리케이션이 위치한다.
7. work : 톰캣이 실행되는 동안 사용되는 작업 파일이 위치한다.
8. startup.bat : 톰캣을 독립 프로세스(또는 새로운 명령 프롬프트)로 시작한다.
9. shutdown.bat : 실행된 톰캣을 종료 시킨다.
10. catalina.bat : 톰캣을 시작하거나 종료한다.
    1. start : 톰캣을 별도 프로세스로 시작한다. startup.bat 동일
    2. stop : 실행 중인 톰캣을 종료시킨다. shutdown.bat 동일
    3. run : 현재 명령 프롬프트에서 톰캣을 시작한다.
    4. version : 현재 톰캣 버전을 화면에 출력한다.
